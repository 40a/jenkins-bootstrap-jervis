#!/bin/sh
RPM_BASED=false
DEB_BASED=false

#detect using RedHat based package
if [ -e '/etc/sysconfig/@@ARTIFACTNAME@@' ]; then
  RPM_BASED=true
fi

if ${RPM_BASED}; then
  [ -e '/etc/sysconfig/@@ARTIFACTNAME@@' ] && source '/etc/sysconfig/@@ARTIFACTNAME@@'
  JENKINS_HOME="${JENKINS_HOME:-@@HOME@@}"
  JENKINS_USER="${JENKINS_USER:-@@USER@@}"
  RPM_INSTALL_PREFIX="${RPM_INSTALL_PREFIX:-@@PREFIX@@}"

  case $1 in
    0)
      # if this is uninstallation as opposed to upgrade, delete the service
      service @@ARTIFACTNAME@@ stop > /dev/null 2>&1
      chkconfig --del @@ARTIFACTNAME@@
      #remove a symlink based on upstream RPM spec (see postInstall.sh.in for creation)
      rm -f "${RPM_INSTALL_PREFIX}/sbin/rc@@ARTIFACTNAME@@"
    ;;
    1)
      #this is an upgrade; best to commit before upgrading package
      su -s /bin/bash -c "${JENKINS_HOME}/dailycommit.sh" - ${JENKINS_USER}
    ;;
  esac
fi

exit 0
